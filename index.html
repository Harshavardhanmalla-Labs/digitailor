<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DigiTailor â€“ Free Local AI Resume Tailoring</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand:#3b82f6; --brand-dark:#2563eb; --bg:#0b1220; }
    html,body { height:100% }
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:#e5e7eb }
    .card { background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
            border:1px solid rgba(255,255,255,.08); border-radius:16px; backdrop-filter: blur(12px); }
    .glass { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); border-radius:14px; }
    .pill { border:1px dashed rgba(255,255,255,.18); border-radius:999px; padding:.35rem .65rem; font-size:.8rem; color:#cbd5e1; }
    .btn { background:var(--brand); color:#fff; border-radius:12px; padding:.7rem 1rem; font-weight:700 }
    .btn:hover { background:var(--brand-dark) }
    .btn-sec { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:.7rem 1rem; font-weight:600 }
    textarea, input { background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:12px; color:#e5e7eb; outline:none }
    textarea:focus, input:focus { border-color: rgba(59,130,246,.6); box-shadow: 0 0 0 4px rgba(59,130,246,.15) }
    .meter { height:12px; background:rgba(255,255,255,.08); border-radius:999px; overflow:hidden }
    .meter > span { display:block; height:100%; background:linear-gradient(90deg,#22c55e,#84cc16) }
    .badge { background:rgba(34,197,94,.12); color:#86efac; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; border:1px solid rgba(34,197,94,.3) }
    .warn { background:rgba(245,158,11,.12); color:#fde68a; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; border:1px solid rgba(245,158,11,.3) }
    .danger { background:rgba(239,68,68,.12); color:#fecaca; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; border:1px solid rgba(239,68,68,.3) }
    .small { font-size:.85rem; color:#94a3b8 }
    .brand-logo { max-height:56px; height:auto; width:auto; object-fit:contain }
    .spinner {
      width:18px; height:18px; border-radius:50%; border:2px solid rgba(255,255,255,.25);
      border-top-color:#93c5fd; animation:spin .9s linear infinite; display:inline-block; vertical-align:middle
    }
    @keyframes spin { to { transform: rotate(360deg) } }
  </style>
</head>
<body>
  <header class="max-w-6xl mx-auto px-5 pt-8 pb-6">
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <img src="Logo_Big.png" alt="DigiTailor logo" class="brand-logo">
        <div>
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">DigiTailor</h1>
          <p class="text-slate-400 -mt-1 text-sm">Free â€¢ Local AI â€¢ ATS Match â€¢ Tailored Resume â€¢ LinkedIn Optimization</p>
        </div>
      </div>
      <div class="hidden md:flex items-center gap-2">
        <span id="aiStatus" class="pill">Local AI: <span class="text-blue-300">loading modelâ€¦</span> <span class="spinner"></span></span>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-5 pb-24">
    <!-- Intro -->
    <section class="card p-5 md:p-7 mb-8">
      <div class="grid md:grid-cols-2 gap-6 items-center">
        <div>
          <div class="pill inline-block mb-3">100% Free for Students</div>
          <h2 class="text-3xl md:text-4xl font-extrabold mb-3">Tailor your resume to any job â€” privately in your browser</h2>
          <p class="text-slate-300 mb-5">Paste a <strong>Job Description</strong> and your <strong>Resume</strong>. Local AI finds keywords, computes a semantic <strong>ATS score</strong>, suggests tailored bullets, and generates <strong>LinkedIn</strong> headline/About.</p>
          <div class="flex flex-wrap gap-3">
            <button id="demoBtn" class="btn">Load Demo</button>
            <button id="clearBtn" class="btn-sec">Clear All</button>
            <span class="small">First run downloads a small model (~90MB). Then itâ€™s cached.</span>
          </div>
        </div>
        <div class="rounded-xl overflow-hidden border border-white/10">
          <img src="https://images.unsplash.com/photo-1606761568499-6d2451b23c07?q=80&w=1600&auto=format&fit=crop" alt="Resume workspace">
        </div>
      </div>
    </section>

    <!-- Inputs -->
    <section class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="card p-5 md:p-6">
        <h3 class="text-xl font-bold mb-3">1) Job Description</h3>
        <textarea id="jd" class="w-full h-56 p-4" placeholder="Paste the Job Description hereâ€¦"></textarea>
        <div class="flex items-center justify-between mt-3">
          <span class="small">AI will extract role, skills, and priorities.</span>
          <button id="analyzeBtn" class="btn">Analyze</button>
        </div>
      </div>
      <div class="card p-5 md:p-6">
        <h3 class="text-xl font-bold mb-3">2) Your Resume</h3>
        <textarea id="resume" class="w-full h-56 p-4" placeholder="Paste your resume here (text)â€¦"></textarea>
        <div class="flex items-center justify-between mt-3">
          <label class="small flex items-center gap-2">
            <input id="actionVerbs" type="checkbox" class="accent-blue-500" checked> Prefer strong action verbs
          </label>
          <button id="tailorBtn" class="btn">Tailor to JD</button>
        </div>
      </div>
    </section>

    <!-- AI Results -->
    <section class="grid md:grid-cols-3 gap-6 mb-8">
      <div class="card p-5 md:p-6">
        <h3 class="text-xl font-bold mb-2">ATS Score (Semantic)</h3>
        <div class="meter mb-2"><span id="atsBar" style="width:0%"></span></div>
        <div class="flex items-center gap-3">
          <div id="atsScore" class="text-3xl font-extrabold">â€”</div>
          <div id="atsBadge" class="badge hidden">Good match</div>
          <div id="atsWarn" class="warn hidden">Needs work</div>
          <div id="atsDanger" class="danger hidden">Low match</div>
        </div>
        <p id="atsHint" class="small mt-2"></p>
      </div>
      <div class="card p-5 md:p-6">
        <h3 class="text-xl font-bold mb-2">Missing / Lowâ€‘coverage Keywords</h3>
        <div id="missingKeywords" class="flex flex-wrap gap-2"></div>
      </div>
      <div class="card p-5 md:p-6">
        <h3 class="text-xl font-bold mb-2">Recommended Sections</h3>
        <ul class="list-disc pl-6 text-slate-300 space-y-1">
          <li>Impact bullets with metrics</li>
          <li>Skills block with JD keywords</li>
          <li>Roleâ€‘specific summary</li>
        </ul>
      </div>
    </section>

    <!-- Tailored outputs -->
    <section class="grid md:grid-cols-2 gap-6 mb-8">
      <div class="card p-5 md:p-6">
        <h3 class="text-xl font-bold mb-3">Tailored Resume Content</h3>
        <div class="grid md:grid-cols-1 gap-4">
          <div class="glass p-4">
            <h4 class="font-semibold mb-2">Tailored Summary</h4>
            <textarea id="tailoredSummary" class="w-full h-32 p-3" placeholder="Will appear here after Tailorâ€¦"></textarea>
            <div class="flex gap-3 mt-2">
              <button class="btn-sec" data-copy="#tailoredSummary">Copy</button>
            </div>
          </div>
          <div class="glass p-4">
            <h4 class="font-semibold mb-2">Tailored Bullets</h4>
            <textarea id="tailoredBullets" class="w-full h-40 p-3" placeholder="Will appear here after Tailorâ€¦"></textarea>
            <div class="flex gap-3 mt-2">
              <button class="btn-sec" data-copy="#tailoredBullets">Copy</button>
            </div>
          </div>
        </div>
        <div class="flex items-center gap-3 mt-4">
          <button id="downloadTxt" class="btn">Download tailored resume (.txt)</button>
          <span class="small">Edit freely before downloading.</span>
        </div>
      </div>

      <div class="card p-5 md:p-6">
        <h3 class="text-xl font-bold mb-3">LinkedIn Optimization</h3>
        <div class="space-y-3">
          <div>
            <label class="small block mb-1">Headline</label>
            <input id="liHeadline" class="w-full p-3" placeholder="e.g., Product Manager | AI Integrations | Driving 0â†’1 Growth" />
          </div>
          <div>
            <label class="small block mb-1">About (Summary)</label>
            <textarea id="liAbout" class="w-full h-32 p-3" placeholder="Paste your current About or leave blankâ€¦"></textarea>
          </div>
          <div>
            <label class="small block mb-1">Skills (commaâ€‘separated)</label>
            <input id="liSkills" class="w-full p-3" placeholder="e.g., Python, SQL, Kubernetes, Stakeholder Management" />
          </div>
          <div class="flex gap-3">
            <button id="optimizeLI" class="btn">Optimize</button>
            <button id="copyLI" class="btn-sec">Copy All</button>
          </div>
          <div id="liSuggestions" class="mt-3 text-slate-300"></div>
        </div>
      </div>
    </section>

    <section class="card p-5 md:p-6">
      <h3 class="text-xl font-bold mb-2">How it works (free & local)</h3>
      <ol class="list-decimal pl-6 text-slate-300 space-y-1">
        <li>Embeds JD and resume with a small sentence-transformer model (local).</li>
        <li>Computes semantic similarity and extracts top phrases (KeyBERTâ€‘style).</li>
        <li>Suggests tailored bullets and LinkedIn copy using structured templates.</li>
      </ol>
      <p class="small mt-3">Note: Heuristic rewriter (nonâ€‘generative) for zero cost & privacy. Results improve when you add metrics.</p>
    </section>
  </main>

  <footer class="max-w-6xl mx-auto px-5 pb-12 text-slate-400">
    <div class="text-sm">Hero image link (copyable). If you canâ€™t click it, ask me for the link only and Iâ€™ll help.</div>
    <div class="mt-2 text-xs break-all">
      https://images.unsplash.com/photo-1606761568499-6d2451b23c07?q=80&w=1600&auto=format&fit=crop
    </div>
  </footer>

  <!-- Local AI (Transformers.js) -->
<script type="module">
  // Multi-CDN dynamic import with timeout, then run Transformers in no-worker mode.
  const $ = s => document.querySelector(s);
  const setStatus = (html) => $('#aiStatus').innerHTML = html;

  async function importWithFallbacks() {
    const SOURCES = [
      'https://cdn.jsdelivr.net/npm/@xenova/transformers@3.0.0',
      'https://unpkg.com/@xenova/transformers@3.0.0',
      'https://esm.sh/@xenova/transformers@3.0.0'
    ];
    const TIMEOUT_MS = 20000;
    for (const src of SOURCES) {
      try {
        const p = import(src);
        const mod = await Promise.race([
          p,
          new Promise((_, rej) => setTimeout(() => rej(new Error('import timeout')), TIMEOUT_MS))
        ]);
        return { mod, src };
      } catch (e) {
        console.warn('Import failed from', src, e);
      }
    }
    throw new Error('All CDN imports failed');
  }

  // Small helpers used below:
  const STOP = new Set(("a,an,and,or,but,if,then,else,when,at,from,into,by,for,with,without,of,on,off,over,under,to,in,out,up,down,as,about,is,are,was,were,be,been,being,the,this,that,those,these,its,it,with,via,per".split(',')));
  const toks = t => (t||'').toLowerCase().replace(/[^a-z0-9+#./ ]/g,' ').split(/\s+/).filter(w => w && !STOP.has(w));
  const splitSentences = (text) => (text||'').replace(/\n+/g,' ').split(/(?<=[.!?])\s+/).map(s=>s.trim()).filter(Boolean);
  const cosine = (a,b)=>{let d=0,na=0,nb=0;for(let i=0;i<a.length;i++){d+=a[i]*b[i];na+=a[i]*a[i];nb+=b[i]*b[i]}return d/(Math.sqrt(na)*Math.sqrt(nb)+1e-9);};
  const ACTION_VERBS = ["Led","Built","Drove","Launched","Owned","Architected","Automated","Optimized","Improved","Accelerated","Reduced","Increased","Consolidated","Migrated","Scaled","Delivered","Mentored","Coordinated","Implemented","Engineered","Designed","Refactored","Analyzed","Resolved","Managed","Developed","Executed","Negotiated","Prioritized","Defined","Streamlined"];

  function pills(container, items){
    container.innerHTML = items.length
      ? items.map(i => `<span class="pill">${i}</span>`).join('')
      : `<span class="small">No obvious gaps detected ðŸŽ‰</span>`;
  }

  // Heuristic fallbacks (work even if AI canâ€™t load)
  function heuristicKeywords(jd) {
    const freq = new Map(); toks(jd).forEach(w => freq.set(w,(freq.get(w)||0)+1));
    return [...freq.entries()].sort((a,b)=>b[1]-a[1]).slice(0,20).map(([w])=>w);
  }
  function heuristicATS(jd,resume){
    const J=new Set(toks(jd)), R=new Set(toks(resume));
    const inter=[...J].filter(x=>R.has(x)).length;
    const score = Math.round((inter / Math.max(1,J.size)) * 100);
    return { score, details: 'Heuristic overlap (AI offline)' };
  }
  function guessRole(jd){
    const m = jd.toLowerCase().match(/\b(product|data|software|backend|frontend|ml|ai|designer|marketing|sales|devops|platform)\s+(manager|engineer|developer|analyst|designer|specialist|lead)\b/);
    return m ? m[0].replace(/\b\w/g,c=>c.toUpperCase()) : 'Professional';
  }
  function suggestSummary(kws, role, action){
    const k=kws.slice(0,6).map(x=>x.toUpperCase());
    return `${action?'Actionâ€‘oriented ':''}${role} with strengths in ${k.join(' Â· ')||'roleâ€‘aligned capabilities'}. Delivers measurable outcomes aligned to JD priorities through crossâ€‘functional collaboration.`;
  }
  function rewriteBullets(baseBullets, kws){
    const verbs = ACTION_VERBS, targets = kws.slice(0,6);
    const src = baseBullets.length ? baseBullets : [
      "Managed endâ€‘toâ€‘end delivery with engineering and design.",
      "Improved activation via experiments and insights.",
      "Collaborated with stakeholders to define roadmap."
    ];
    const outs=[];
    for(let i=0;i<Math.min(5,src.length);i++){
      const v=verbs[i%verbs.length], kw=targets[i%Math.max(1,targets.length)];
      outs.push(`${v} ${kw?kw.toUpperCase()+' ':''}initiatives to achieve [metric], leveraging ${kw||'role skills'}; partnered crossâ€‘functionally; measured via [KPI].`);
    }
    return "â€¢ " + outs.join("\nâ€¢ ");
  }

  // Wire UI after we know which mode weâ€™re in:
  function wireUI(impl) {
    const get = s => document.querySelector(s);
    const setATS = ({score, details}, kws, resume) => {
      get('#atsScore').textContent = score;
      get('#atsBar').style.width = `${score}%`;
      get('#atsBadge').classList.add('hidden'); get('#atsWarn').classList.add('hidden'); get('#atsDanger').classList.add('hidden');
      if (score >= 75) get('#atsBadge').classList.remove('hidden');
      else if (score >= 45) get('#atsWarn').classList.remove('hidden');
      else get('#atsDanger').classList.remove('hidden');
      get('#atsHint').textContent = `${details} â€¢ Keywords: ${kws.slice(0,6).join(', ')}`;
      const resTok = new Set(toks(resume));
      const missing = kws.filter(k => !k.split(' ').every(w => resTok.has(w)));
      pills(get('#missingKeywords'), missing.slice(0,25));
    };

    async function analyze() {
      const jd = get('#jd').value, resume = get('#resume').value;
      setStatus(impl.loadingLabel);
      const [kws, ats] = await Promise.all([impl.keywords(jd), impl.ats(jd,resume)]);
      setATS(ats, kws, resume);
      setStatus(impl.readyLabel);
      return {kws};
    }

    async function tailor() {
      const jd = get('#jd').value, resume = get('#resume').value;
      const { kws } = await analyze();
      const role = guessRole(jd);
      get('#tailoredSummary').value = suggestSummary(kws, role, get('#actionVerbs').checked);
      const baseBullets = splitSentences(resume).filter(s => s.length>=20 && s.length<=180);
      get('#tailoredBullets').value = rewriteBullets(baseBullets, kws);
    }

    function optimizeLI(){
      const jd=get('#jd').value, role=guessRole(jd);
      const skills = (get('#liSkills').value||'').split(',').map(s=>s.trim()).filter(Boolean);
      const jdHints = Array.from(new Set(toks(jd))).slice(0,30);
      const top = jdHints.slice(0,6);
      const headline = get('#liHeadline').value || `${role} | ${top.slice(0,2).map(s=>s.toUpperCase()).join(' | ')} | Driving Outcomes`;
      const about = (get('#liAbout').value||'') +
`\n\nFocus: ${top.slice(0,4).map(s=>s.toUpperCase()).join(', ')}
Highlights:
â€¢ Delivered measurable impact aligned to JD themes
â€¢ Crossâ€‘functional collaboration and clear communication
â€¢ Continuous learning and documentation mindset`;
      const addSkills = top.filter(t => !skills.map(s=>s.toLowerCase()).includes(t)).slice(0,8);
      const mergedSkills = Array.from(new Set([...skills, ...addSkills])).join(', ');
      get('#liHeadline').value = headline; get('#liAbout').value = about.trim(); get('#liSkills').value = mergedSkills;
      get('#liSuggestions').innerHTML = `
        <div class="grid gap-3">
          <div class="glass p-3"><div class="font-semibold mb-1">Headline</div><div class="small text-slate-200">${headline}</div></div>
          <div class="glass p-3"><div class="font-semibold mb-1">About</div><div class="small text-slate-200 whitespace-pre-wrap">${about}</div></div>
          <div class="glass p-3"><div class="font-semibold mb-1">Skills</div><div class="flex flex-wrap gap-2">${mergedSkills.split(',').map(s=>`<span class="pill">${s.trim()}</span>`).join('')}</div></div>
        </div>`;
    }

    // Bind
    $('#analyzeBtn').addEventListener('click', analyze);
    $('#tailorBtn').addEventListener('click', tailor);
    $('#optimizeLI').addEventListener('click', optimizeLI);

    $('#demoBtn')?.addEventListener('click', ()=>{
      $('#jd').value = `We are seeking a Product Manager to lead AI/ML platform initiatives. Requirements include experience with Python, SQL, data pipelines, and cloud (AWS/GCP). Strong stakeholder management, Agile/Jira, and analytics background preferred. PMP or Scrum a plus. Responsibilities: define roadmap, collaborate with engineering, launch features, measure impact.`;
      $('#resume').value = `Product Manager with 5+ years in B2B SaaS. Led roadmap and crossâ€‘functional delivery. Launched onboarding changes improving activation by 18%. Tools: Jira, Tableau, SQL basics. Drove discovery, prioritized backlog, partnered with engineering and design.`;
    });

    $('#clearBtn')?.addEventListener('click', ()=>{
      ['#jd','#resume','#tailoredSummary','#tailoredBullets','#liAbout','#liHeadline','#liSkills'].forEach(s=>$(s).value='');
      $('#liSuggestions').innerHTML=''; $('#atsScore').textContent='â€”'; $('#atsBar').style.width='0%';
      $('#atsBadge').classList.add('hidden'); $('#atsWarn').classList.add('hidden'); $('#atsDanger').classList.add('hidden');
      $('#atsHint').textContent=''; $('#missingKeywords').innerHTML='';
      setStatus(impl.readyLabel);
    });

    // Copy
    document.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click', async (e)=>{
        const target = e.currentTarget.getAttribute('data-copy');
        const el = document.querySelector(target);
        try { await navigator.clipboard.writeText(el.value); } catch { el.select(); document.execCommand('copy'); }
        e.currentTarget.textContent='Copied âœ“'; setTimeout(()=>e.currentTarget.textContent='Copy',1200);
      });
    });

    // Download
    $('#downloadTxt')?.addEventListener('click', ()=>{
      const content = ["TAILORED SUMMARY:", $('#tailoredSummary').value, "", "TAILORED BULLETS:", $('#tailoredBullets').value].join("\n");
      const blob = new Blob([content], {type:'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob); const a=document.createElement('a');
      a.href=url; a.download='DigiTailor_tailored_resume.txt'; a.click(); URL.revokeObjectURL(url);
    });
  }

  // Start: try to load Transformers from any CDN; if it fails, use heuristic mode immediately.
  (async () => {
    try {
      setStatus('Local AI: <span class="text-blue-300">initializingâ€¦</span> <span class="spinner"></span>');
      const { mod, src } = await importWithFallbacks();
      const { pipeline, env } = mod;

      // GitHub Pages compatibility: no workers/threads
      env.backends.onnx.wasm.numThreads = 1;
      env.backends.onnx.wasm.proxy = false;
      env.backends.onnx.wasm.simd = true;
      // Optional: point ORT wasm if needed
      // env.backends.onnx.wasm.wasmPaths = 'https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/';

      // Load model with progress + timeout
      const TIMEOUT_MS = 90000;
      let resolved = false;
      const loader = pipeline('feature-extraction', 'Xenova/all-MiniLM-L6-v2', {
        quantized: true,
        progress_callback: (p) => {
          const pct = p?.progress != null ? Math.round(p.progress*100) : null;
          setStatus(`Local AI: <span class="text-blue-300">loading modelâ€¦ ${pct ?? 0}%</span> <span class="spinner"></span>`);
        }
      });
      const embed = await Promise.race([
        loader.then(x => { resolved = true; return x; }),
        new Promise((_, rej) => setTimeout(()=>rej(new Error('model timeout')), TIMEOUT_MS))
      ]);

      // Helper functions using the embedder
      async function getEmbedding(text){
        const out = await embed(text, { pooling: 'mean', normalize: true });
        return Array.from(out.data);
      }
      async function embedMany(list){
        const out = await embed(list, { pooling: 'mean', normalize: true });
        const dim = out.dims || (out.data.length / list.length);
        const res=[]; for(let i=0;i<list.length;i++){ res.push(Array.from(out.data.slice(i*dim,(i+1)*dim))); } return res;
      }
      function candidates(text,maxN=3){ const words=toks(text); const c=new Set(); for(let n=1;n<=maxN;n++){ for(let i=0;i<=words.length-n;i++){ c.add(words.slice(i,i+n).join(' ')); } } return Array.from(c).filter(s=>s.length>=3&&!/^\d+$/.test(s)); }
      function selectMMR(docVec, candVecs, candList, topK=20, lambda=0.7){
        const selected=[]; const rel=candVecs.map(v=>cosine(docVec,v)); const picked=new Set();
        while(selected.length<Math.min(topK,candList.length)){
          let best=-1,score=-Infinity;
          for(let i=0;i<candList.length;i++){
            if(picked.has(i)) continue;
            const r=rel[i]; let div=0; for(const j of selected){ div=Math.max(div, cosine(candVecs[i], candVecs[j])); }
            const mmr=lambda*r-(1-lambda)*div; if(mmr>score){score=mmr;best=i;}
          }
          if(best===-1) break; picked.add(best); selected.push(best);
        }
        return selected.map(i=>({ phrase:candList[i], score:rel[i] }));
      }

      async function extractKeywordsJD(jd){
        if (!jd.trim()) return [];
        const cands = candidates(jd,3).slice(0,400);
        const [docVec, candVecs] = await Promise.all([getEmbedding(jd), embedMany(cands)]);
        const ranked = selectMMR(docVec, candVecs, cands, 25, 0.75)
          .sort((a,b)=>b.score-a.score)
          .map(x=>x.phrase);
        const seen=new Set(), uniq=[]; for(const k of ranked){ const key=k.replace(/s$/,''); if(!seen.has(key)){ seen.add(key); uniq.push(k); } }
        return uniq.slice(0,20);
      }

      async function atsScoreSemantic(jd, resume){
        if (!jd.trim() || !resume.trim()) return { score: 0, details: 'Provide JD and resume.' };
        const jdS=splitSentences(jd).slice(0,12), resS=splitSentences(resume).slice(0,24);
        const [jv, rv] = await Promise.all([embedMany(jdS), embedMany(resS)]);
        const matches = jv.map(v => Math.max(...rv.map(w => cosine(v,w))));
        const avg = matches.reduce((a,b)=>a+b,0)/(matches.length||1);
        const score = Math.round(Math.max(0, Math.min(1, (avg-0.3)/0.5)) * 100);
        return { score, details:`Avg semantic match ${(avg*100).toFixed(1)}%` };
      }

      setStatus('Local AI: <span class="text-green-300">ready</span> âœ“');

      // Wire UI with AI implementation
      wireUI({
        loadingLabel: 'Local AI: <span class="text-blue-300">analyzingâ€¦</span> <span class="spinner"></span>',
        readyLabel: 'Local AI: <span class="text-green-300">ready</span> âœ“',
        keywords: extractKeywordsJD,
        ats: atsScoreSemantic
      });

    } catch (e) {
      console.error('AI mode failed, switching to heuristic:', e);
      setStatus('Local AI: <span class="text-amber-300">unavailable â€” heuristic mode</span>');

      // Wire UI with heuristic implementation (always works)
      wireUI({
        loadingLabel: 'Heuristic: <span class="text-blue-300">analyzingâ€¦</span> <span class="spinner"></span>',
        readyLabel: 'Heuristic: <span class="text-amber-300">ready</span>',
        keywords: async (jd) => heuristicKeywords(jd),
        ats: async (jd,resume) => heuristicATS(jd,resume)
      });
    }
  })();
</script>


</body>
</html>


